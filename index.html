<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>è‚²æˆãƒãƒ©ãƒ³ã‚¹é…ç½®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>

<style>
:root{
  --bg:#fff7f0;
  --card:#ffffff;
  --accent:#f2b5b5;
  --accent2:#b5d8f2;
  --border:#e0cfc2;
}

body{
  font-family:"Hiragino Maru Gothic ProN","Yu Gothic",sans-serif;
  background:var(--bg);
  margin:0;
  padding:20px;
  color:#4a3b2a;
}

h1{
  text-align:center;
  margin-bottom:30px;
}

h2{
  margin-top:40px;
  border-left:6px solid var(--accent);
  padding-left:10px;
}

.card{
  background:var(--card);
  border-radius:16px;
  box-shadow:0 6px 12px rgba(0,0,0,0.15);
  padding:16px;
  margin-bottom:20px;
}

.char-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
  gap:16px;
}

.char-card{
  border:2px solid var(--border);
  border-radius:14px;
  padding:12px;
  background:#fffdf9;
  display:flex;
  gap:10px;
}

.char-card.off{
  opacity:0.45;
  filter:grayscale(40%);
}

.char-img{
  max-width:70px;
  max-height:90px;
  object-fit:contain;
  border-radius:10px;
  border:1px solid var(--border);
  flex-shrink:0;
}

.char-info{ flex:1; }

.char-name{
  font-weight:bold;
  font-size:18px;
}

.exec-btn{
  margin-top:6px;
  padding:6px 14px;
  border-radius:6px;
  border:1px solid #999;
  font-size:12px;
  cursor:pointer;
  background:linear-gradient(#fefefe,#dcdcdc);
}

.exec-btn.owned{
  background:linear-gradient(#ffdede,#f2b5b5);
}

.skills{
  font-size:14px;
  margin:6px 0;
}

/* ä»»å‘½è¡¨ç¤º */
.assign{
  margin:6px 0;
  padding:6px;
  font-size:12px;
  border:1px dashed var(--border);
  border-radius:8px;
}

.role{
  display:inline-block;
  margin-right:6px;
  padding:2px 6px;
  border-radius:6px;
  background:#eee;
  color:#999;
  font-weight:bold;
}

.role.active{
  background:#f2b5b5;
  color:#4a3b2a;
}

.assign-facility{
  margin-top:4px;
  font-size:11px;
}

.lv{
  font-size:14px;
}

.lv input{
  width:50px;
  text-align:center;
}

.lv-btns button{
  background:var(--accent2);
  border:none;
  border-radius:8px;
  padding:4px 6px;
  margin:2px;
  font-size:12px;
  cursor:pointer;
}

.facility{ margin-bottom:6px; }

.result-card{
  background:#fff;
  border-radius:14px;
  padding:10px;
  margin-bottom:10px;
  box-shadow:0 4px 8px rgba(0,0,0,0.12);
}
</style>
</head>

<body>

<h1>ğŸŒ¸ è‚²æˆãƒãƒ©ãƒ³ã‚¹é…ç½®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ ğŸŒ¸</h1>

<h2>â‘  çŸ¥å·±ä¸€è¦§</h2>
<div class="card">
  <div class="char-grid" id="charArea"></div>
</div>

<h2>â‘¡ æ–½è¨­ä¸€è¦§</h2>
<div class="card" id="facilityArea"></div>

<h2>â‘¢ é…ç½®çµæœ</h2>
<div class="card" id="result"></div>

<script>
const STORAGE_KEY="chigi_state_v3";

const facilities=[
 ["æœ±é›€å¤§é€šã‚Š","çµµç”»","å‰£","ç´"],
 ["èƒ¡å§«é…’å ´","å°†æ£‹","é¦¬","ç”Ÿã‘èŠ±"],
 ["å½±çµµèŠå±…å°å±‹","é…’","é¦¬","æ›¸é“"],
 ["è¯æ¸…æ± ","é…’","æ­¦","å°†æ£‹"],
 ["éŠèŠ¸é¤¨","è©©æ­Œ","å°„","é…’"],
 ["æåœ’","è©©æ­Œ","å°„","æ›¸é“"],
 ["é›å¡”åºƒå ´","çµµç”»","æ­¦","ç”Ÿã‘èŠ±"],
 ["å¤§æ…ˆæ©å¯º","ç´","å‰£","èŒ¶"]
];

const characters=[
 ["æ—å©‰å…",["çµµç”»","å‰£","ç´"],82],
 ["ã‚¯ãƒ¬ã‚ªãƒ‘ãƒˆãƒ©",["çµµç”»","æ­¦","ç”Ÿã‘èŠ±"],70],
 ["ç‘¤å§«",["çµµç”»","æ­¦","ç”Ÿã‘èŠ±"],69],
 ["ãƒ ãƒ¼ãƒ©ãƒ³",["çµµç”»","å‰£","ç´"],57],
 ["ã‚¨ã‚«ãƒãƒ¥ãƒªãƒ¼ãƒŠ",["ç´","å‰£","èŒ¶"],77],
 ["ä¸Šå®˜å©‰å…",["ç´","å‰£","é…’"],65],
 ["è²‚è‰",["ç´","é¦¬","èŒ¶"],53],
 ["ãŠå¸‚",["é…’","é¦¬","ç´™"],92],
 ["é«˜æ¼¸é›¢",["é…’","å‰£","çµµç”»"],51],
 ["è¶™é£›ç‡•",["è©©æ­Œ","å°„","é…’"],90],
 ["è‘‰è»½çœ‰",["è©©æ­Œ","å°„","æ›¸é“"],3],
 ["ææ¸…ç…§",["è©©æ­Œ","å°„","æ›¸é“"],79],
 ["æå¸«å¸«",["è©©æ­Œ","å°„","æ›¸é“"],3],
 ["è¥¿æ–½",["è©©æ­Œ","é¦¬","æ›¸é“"],61],
 ["å¦²å·±",["å°†æ£‹","å‰£","ç´"],68],
 ["ç²¾è¡›",["å°†æ£‹","å°„","ç”Ÿã‘èŠ±"],76],
 ["ã‚¸ãƒ£ãƒ³ãƒŒãƒ»ãƒ€ãƒ«ã‚¯",["å°†æ£‹","é¦¬","ç”Ÿã‘èŠ±"],62],
 ["é˜ç„¡è‰¶",["èŒ¶","æ­¦","æ›¸é“"],91],
 ["éˆ•ç¥œç¦„æ°",["èŒ¶","æ­¦","çµµç”»"],40],
 ["ãƒ´ã‚£ã‚¯ãƒˆãƒªã‚¢",["èŒ¶","æ­¦","å°†æ£‹"],3],
 ["æŸ³å¦‚æ˜¯",["é…’","é¦¬","ç”Ÿã‘èŠ±"],0],
 ["åŒ—æ¡æ”¿å­",["çµµç”»","å‰£","ç´"],0],
 ["æ¥Šç‰ç’°",["èŒ¶","æ­¦","å°†æ£‹"],0],
 ["ã‚¨ãƒªã‚¶ãƒ™ã‚¹",["è©©æ­Œ","å°„","é…’"],0],
 ["å«¦å¨¥",["çµµç”»","å‰£","ç´"],0],
 ["ãƒŸãƒ¼ãƒ¦ã‚¨",["å°†æ£‹","é¦¬","ç”Ÿã‘èŠ±"],0]
];

const saved=JSON.parse(localStorage.getItem(STORAGE_KEY)||"{}");
const state=[];
const charArea=document.getElementById("charArea");

function saveState(){
  const o={};
  state.forEach(c=>o[c.name]={owned:c.owned,lv:c.lv});
  localStorage.setItem(STORAGE_KEY,JSON.stringify(o));
}

function renderCharacters(){
  charArea.innerHTML="";
  state.length=0;

  characters.forEach((c,i)=>{
    const s=saved[c[0]]||{};
    const obj={
      name:c[0],
      skills:c[1],
      lv:s.lv??c[2],
      owned:s.owned??(c[2]>0),
      assign:null
    };
    state.push(obj);

    const d=document.createElement("div");
    d.className="char-card"+(obj.owned?"":" off");

    d.innerHTML=`
      <img class="char-img" src="img/${obj.name}.jpg"
       onerror="this.onerror=null;this.src='img/${obj.name}.png'">

      <div class="char-info">
        <div class="char-name">${obj.name}</div>

        <button class="exec-btn ${obj.owned?"owned":""}"
          onclick="toggleOwned(${i})">
          ${obj.owned?"ä¿æœ‰ä¸­":"æœªä¿æœ‰"}
        </button>

        <div class="skills">ğŸ¨ ${obj.skills.join("ãƒ»")}</div>

        <div class="assign">
          <span class="role">åº—é•·</span>
          <span class="role">å‰¯åº—é•·</span>
          <span class="role">è£œæ¬ </span>
          <div class="assign-facility">â€”</div>
        </div>

        <div class="lv">
          Lv <input type="number" value="${obj.lv}" readonly ${obj.owned?"":"disabled"}>
          <div class="lv-btns">
            <button onclick="changeLv(${i},10)">+10</button>
            <button onclick="changeLv(${i},1)">+1</button>
            <button onclick="changeLv(${i},-1)">-1</button>
            <button onclick="changeLv(${i},-10)">-10</button>
          </div>
        </div>
      </div>`;
    charArea.appendChild(d);
  });
}

function toggleOwned(i){
  const c = state[i];
  c.owned = !c.owned;

  const card = charArea.children[i];
  card.classList.toggle("off", !c.owned);

  const btn = card.querySelector(".exec-btn");
  btn.textContent = c.owned ? "ä¿æœ‰ä¸­" : "æœªä¿æœ‰";
  btn.classList.toggle("owned", c.owned);

  // Lvæ“ä½œã®æœ‰åŠ¹ãƒ»ç„¡åŠ¹
  card.querySelectorAll(".lv input, .lv button")
    .forEach(el => el.disabled = !c.owned);

  saveState();
  run();
}

function changeLv(i,d){
  if(!state[i].owned)return;
  state[i].lv=Math.max(0,state[i].lv+d);
  saveState();
  run();
}

const facilityArea=document.getElementById("facilityArea");
facilities.forEach(f=>{
  const d=document.createElement("div");
  d.className="facility";
  d.textContent=`${f[0]}ï¼š${f[1]}ãƒ»${f[2]}ãƒ»${f[3]}`;
  facilityArea.appendChild(d);
});

function run(){
  const result=document.getElementById("result");
  result.innerHTML="";
  state.forEach(c=>c.assign=null);
  const used=new Set();

  facilities.forEach(f=>{
    const req=f.slice(1);
    const ranked=state
      .filter(c=>c.owned && c.lv>0 && !used.has(c.name))
      .map(c=>({c,match:req.filter(r=>c.skills.includes(r)).length}))
      .sort((a,b)=>b.match-a.match||b.c.lv-a.c.lv);

    if(ranked[0]){
      ranked[0].c.assign={facility:f[0],role:"åº—é•·"};
      used.add(ranked[0].c.name);
    }
    if(ranked[1]){
      ranked[1].c.assign={facility:f[0],role:"å‰¯åº—é•·"};
      used.add(ranked[1].c.name);
    }
    if(ranked[2]){
      ranked[2].c.assign={facility:f[0],role:"è£œæ¬ "};
    }

    const div=document.createElement("div");
    div.className="result-card";
    div.innerHTML=`<strong>${f[0]}</strong><br>
      ğŸ® åº—é•·ï¼š${ranked[0]?.c.name||"â€”"}<br>
      ğŸŒ¿ å‰¯åº—é•·ï¼š${ranked[1]?.c.name||"â€”"}`;
    result.appendChild(div);
  });

  state.forEach((c,i)=>{
    const box=charArea.children[i].querySelector(".assign");
    const roles=box.querySelectorAll(".role");
    roles.forEach(r=>r.classList.remove("active"));

    if(c.assign){
      if(c.assign.role==="åº—é•·")roles[0].classList.add("active");
      if(c.assign.role==="å‰¯åº—é•·")roles[1].classList.add("active");
      if(c.assign.role==="è£œæ¬ ")roles[2].classList.add("active");
      box.querySelector(".assign-facility").textContent="ğŸ® "+c.assign.facility;
    }else{
      box.querySelector(".assign-facility").textContent="â€”";
    }
  });
}

renderCharacters();
run();
</script>

</body>
</html>
